version: '3'
services:
  db:
    image: mdillon/postgis:9.6-alpine
    volumes:
      - db:/var/lib/postgresql/data

  redis:
    image: redis:latest

  app:
    image: umap
    ports:
      - "7000:8000"
    environment:
      - DATABASE_URL=postgis://postgres@db/postgres
      - REDIS_URL=redis://redis:6379/0
      - SECRET_KEY=${SECRET_KEY}
      - ALLOWED_HOSTS=*
      - SITE_URL=${SITE_URL}
      - LEAFLET_STORAGE_ALLOW_ANONYMOUS=False
    volumes:
      - umap_uploads:/srv/umap/uploads
